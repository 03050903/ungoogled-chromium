# Development notes and procedures

## Workflow of updating patches

Tested on Debian 9.0 (stretch). Exact instructions should work on any other Linux or macOS system with the proper dependencies.

### Dependencies

* `quilt`
    * This utility is what drives most of the updating process, so it is important to learn this relatively well. The manpage for quilt (as of early 2017) has a general overview of how its text-user-interface and internals work together, but it lacks a clear example of a workflow. There are multiple guides online, but [this guide from Debian](https://wiki.debian.org/UsingQuilt) and [the referenced guide on that page](https://raphaelhertzog.com/2012/08/08/how-to-use-quilt-to-manage-patches-in-debian-packages/) are decent.
* Python 3.5 or newer

### Steps

1. Download and extract the Chromium source tree into a sandbox directory (conventionally `build/sandbox`) using `utilites/prepare_dependencies.py` (pass in `-h` or `--help` for arguments)
2. Copy the patches to be updated into the build sandbox using `developer_utilities/generate_config_patches.sh` (see the top of the script for the arguments it accepts)
    * Choose the appropriate configuration that contains the patches to be updated. To get just the common patches, use the `common` config.
3. Run `source $ROOT/developer_utilities/set_quilt_vars.sh`, where `$ROOT` is the ungoogled-chromium directory.
4. Use `quilt` to update the patches. The general procedure is as follows:
    1. Make sure all patches are unapplied: `quilt pop -a`. Check the status with `quilt top`
    2. Execute shell loop: `while quilt push; do quilt refresh -p ab; done`
    3. If encountered an error, do `quilt push -f`
    4. Edit the broken files as necessary, adding (`quilt add ...`) or removing (`quilt remove ...`) files as necessary
    5. `quilt refresh -p ab`
    6. Go back and continue from Step 2, repeating until all of the patches have been fixed
    7. Copy contents of `build/sandbox/ungoogled_patches/patches` into `resources/patches`
    8. Remove backup patch files (ending in `.patch~`) generated by `quilt` as necessary: `find resources/patches -name "*.patch~" | xargs rm`

This should leave you with unstaged changes in your git repository to be reviewed, added, and committed.
